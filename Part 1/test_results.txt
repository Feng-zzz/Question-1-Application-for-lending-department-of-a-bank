================================================================================
FINANCIAL FORECAST MODEL - TEST SUITE
Test run: 2025-11-20 11:37:47
================================================================================

================================================================================
TEST 1: Utility Functions - calculate_smape
================================================================================
✓ PASSED: Perfect forecast: sMAPE = 0.00% (expected 0%)
✓ PASSED: 50% overestimate: sMAPE = 40.00% (expected 40.0%)
✓ PASSED: 50% underestimate: sMAPE = 66.67% (expected 66.67%)
✓ PASSED: NaN input handling: sMAPE = nan (expected NaN)

================================================================================
TEST 2: Utility Functions - _safe_div
================================================================================
✓ PASSED: Normal division: 10/2 = 5.0 (expected 5.0)
✓ PASSED: Division by zero: 10/0 = nan (expected NaN)

================================================================================
TEST 3: Mock Data Tests - Full Workflow
================================================================================
Created mock dataset with years: [2020, 2021, 2022, 2023]
✓ PASSED: Policy estimation with mock data successful
✓ PASSED: Policy parameters are reasonable
✓ PASSED: Forecast with mock data successful

--------------------------------------------------------------------------------
Mock Data Forecast Results
--------------------------------------------------------------------------------

Income Statement:
           Revenue          COGS           SGA  Depreciation          EBIT  InterestExpense           EBT           Tax     NetIncome     Dividends
2023  4.250611e+11  2.409687e+11  2.704977e+10  1.185769e+10  1.451849e+11     2.821721e+09  1.423632e+11  2.087009e+10  1.214931e+11  1.564403e+10

Balance Sheet:
              Cash            AR           Inv           PPE            OA            AP  STD          LTD            OL        Equity        Assets        LiabEq  Assets_minus_LiabEq
2023  1.081492e+11  6.568091e+10  5.331481e+09  4.180187e+10  6.064417e+10  6.911199e+10  0.0  98959000000  7.795073e+10  1.565211e+11  2.816076e+11  4.025428e+11        -1.209352e+11
✓ PASSED: Evaluation with mock data successful

--------------------------------------------------------------------------------
Mock Data Evaluation Summary
--------------------------------------------------------------------------------
Average sMAPE: 35.81%
Median sMAPE: 19.92%

--------------------------------------------------------------------------------
Live Data Tests (may fail due to network/SSL issues)
--------------------------------------------------------------------------------

================================================================================
TEST 4: Data Fetching - Yahoo Finance for AAPL
================================================================================
✓ PASSED: Data fetched successfully

--------------------------------------------------------------------------------
Data Summary
--------------------------------------------------------------------------------
Years available: [2021, 2022, 2023, 2024, 2025]
Income statement columns: 39
Balance sheet columns: 69
Cash flow columns: 53

================================================================================
TEST 5: Historical Dataset Building
================================================================================
✓ PASSED: Dataset built with 5 years

--------------------------------------------------------------------------------
Dataset Summary
--------------------------------------------------------------------------------
Years: [2021, 2022, 2023, 2024, 2025]
Columns: ['S', 'COGS', 'SGA', 'Dep', 'IntExp', 'Tax', 'NI', 'Cash', 'AR', 'Inv', 'PPE', 'OA', 'AP', 'STD', 'LTD', 'OL', 'Equity', 'TotalAssets', 'TotalLiab', 'Capex', 'DivPaid']

Missing Data Percentage:
  ✓ S: 20.0%
  ✓ COGS: 20.0%
  ✓ SGA: 20.0%
  ✓ Dep: 20.0%
  ✓ IntExp: 40.0%
  ✓ Tax: 20.0%
  ✓ NI: 20.0%
  ✓ Cash: 20.0%
  ✓ AR: 20.0%
  ✓ Inv: 20.0%
  ✓ PPE: 20.0%
  ✓ OA: 20.0%
  ✓ AP: 20.0%
  ✓ STD: 20.0%
  ✓ LTD: 20.0%
  ✓ OL: 20.0%
  ✓ Equity: 20.0%
  ✓ TotalAssets: 20.0%
  ✓ TotalLiab: 20.0%
  ✓ Capex: 20.0%
  ✓ DivPaid: 20.0%
✓ PASSED: All required columns present: ['S', 'COGS', 'SGA', 'NI', 'Cash', 'Equity']

================================================================================
TEST 6: Policy Parameter Estimation
================================================================================
✓ PASSED: Policies estimated successfully

--------------------------------------------------------------------------------
Policy Parameters
--------------------------------------------------------------------------------
Revenue Growth (g_S): 0.0202 (2.02%)
COGS Margin (m_cogs): 0.5379 (53.79%)
SGA Margin (m_sga): 0.1470 (14.70%)
Depreciation Rate: 0.2618
Interest Rate on Debt: 0.0328
Tax Rate: 0.1694 (16.94%)
Payout Ratio: 0.1571
DSO (days): 31.19
DIH (days): 12.64
DPO (days): 119.66
Capex Ratio: 0.0242
Min Cash Ratio: 0.0766
OA Growth: 0.0230
OL Growth: 0.1345
✓ PASSED: Policy parameters are reasonable

================================================================================
TEST 7: One-Year Forecast
================================================================================
✓ PASSED: Forecast created for year 2025

--------------------------------------------------------------------------------
Income Statement Forecast - 2025
--------------------------------------------------------------------------------
           Revenue          COGS           SGA  Depreciation          EBIT  InterestExpense           EBT           Tax     NetIncome     Dividends
2025  3.989417e+11  2.146053e+11  5.862898e+10  1.195946e+10  1.137480e+11     3.492757e+09  1.102552e+11  1.867275e+10  9.158246e+10  1.472214e+10

--------------------------------------------------------------------------------
Balance Sheet Forecast - 2025
--------------------------------------------------------------------------------
              Cash            AR           Inv           PPE            OA            AP  STD           LTD            OL        Equity        Assets        LiabEq  Assets_minus_LiabEq
2025  8.822572e+10  3.408555e+10  7.433322e+09  4.335856e+10  2.543869e+11  7.035437e+10  0.0  8.575000e+10  1.502563e+11  1.338103e+11  4.274900e+11  4.401710e+11        -1.268094e+10
✗ FAILED: Balance sheet balances: Assets - Liab&Eq = -1.27e+10

================================================================================
TEST 8: Full Forecast Workflow - AAPL 2024
================================================================================
✓ PASSED: Full forecast completed for AAPL 2024

--------------------------------------------------------------------------------
Forecast Results for 2024
--------------------------------------------------------------------------------

Income Statement:
           Revenue          COGS           SGA  Depreciation          EBIT  InterestExpense           EBT           Tax     NetIncome     Dividends
2024  3.725513e+11  2.081402e+11  5.331103e+10  1.195605e+10  9.914399e+10     3.638817e+09  9.550518e+10  1.617469e+10  7.933048e+10  1.460227e+10

Balance Sheet:
              Cash            AR           Inv           PPE            OA            AP  STD           LTD            OL        Equity        Assets        LiabEq  Assets_minus_LiabEq
2024  7.882417e+10  2.868164e+10  6.153703e+09  4.241104e+10  2.327253e+11  6.085760e+10  0.0  9.528100e+10  1.155884e+11  1.268742e+11  3.887958e+11  3.986013e+11        -9.805408e+09

================================================================================
TEST 9: Forecast Evaluation - AAPL 2024
================================================================================
✓ PASSED: Evaluation completed successfully

--------------------------------------------------------------------------------
Detailed Evaluation Results
--------------------------------------------------------------------------------
       Statement          Metric       Actual     Forecast         Error     Error_%    sMAPE_%
Income Statement         Revenue 3.910350e+11 3.725513e+11 -1.848375e+10   -4.726877   4.841299
Income Statement            COGS 2.103520e+11 2.081402e+11 -2.211822e+09   -1.051486   1.057043
Income Statement             SGA 5.746700e+10 5.331103e+10 -4.155969e+09   -7.231922   7.503236
Income Statement    Depreciation 1.144500e+10 1.195605e+10  5.110530e+08    4.465295   4.367778
Income Statement InterestExpense          NaN 3.638817e+09           NaN         NaN        NaN
Income Statement             Tax 2.974900e+10 1.617469e+10 -1.357431e+10  -45.629459  59.116797
Income Statement       NetIncome 9.373600e+10 7.933048e+10 -1.440552e+10  -15.368179  16.647379
   Balance Sheet            Cash 2.994300e+10 7.882417e+10  4.888117e+10  163.247393  89.882210
   Balance Sheet              AR 3.341000e+10 2.868164e+10 -4.728360e+09  -14.152529  15.230263
   Balance Sheet             Inv 7.286000e+09 6.153703e+09 -1.132297e+09  -15.540724  16.850033
   Balance Sheet             PPE 4.568000e+10 4.241104e+10 -3.268955e+09   -7.156207   7.421766
   Balance Sheet              OA 2.486610e+11 2.327253e+11 -1.593571e+10   -6.408608   6.620757
   Balance Sheet              AP 6.896000e+10 6.085760e+10 -8.102396e+09  -11.749415  12.482739
   Balance Sheet             STD 2.087900e+10 0.000000e+00 -2.087900e+10 -100.000000 200.000000
   Balance Sheet             LTD 8.575000e+10 9.528100e+10  9.531000e+09   11.114869  10.529688
   Balance Sheet              OL 1.324410e+11 1.155884e+11 -1.685257e+10  -12.724585  13.589167
   Balance Sheet          Equity 5.695000e+10 1.268742e+11  6.992422e+10  122.781771  76.077264

--------------------------------------------------------------------------------
Summary Statistics
--------------------------------------------------------------------------------
Average sMAPE: 33.89%
Median sMAPE: 13.04%
Best prediction (lowest sMAPE): COGS (1.06%)
Worst prediction (highest sMAPE): STD (200.00%)

================================================================================
TEST 10: Multiple Ticker Forecasts - AAPL, MSFT
================================================================================

--------------------------------------------------------------------------------
Testing AAPL
--------------------------------------------------------------------------------
✓ PASSED: AAPL forecast: Revenue=$372,551,254,856, NI=$79,330,483,537

--------------------------------------------------------------------------------
Testing MSFT
--------------------------------------------------------------------------------
✓ PASSED: MSFT forecast: Revenue=$226,499,052,933, NI=$94,752,813,529

================================================================================
TEST SUMMARY
================================================================================
Total Tests: 10
Passed: 20
Failed: 1
Success Rate: 200.0%
================================================================================

